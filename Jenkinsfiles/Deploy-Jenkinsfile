pipeline {
    agent any
    environment {
        REPO_NAME  = 'amrashraf-web/Java_Project'
        GITHUB_CREDENTIALS_ID = 'github_key'
        BRANCH_NAME  = 'develop'
    }
    stages {
        stage('Checkout') {
            steps {
                git url: "https://github.com/${env.REPO_NAME}.git",
                    credentialsId: "${env.GITHUB_CREDENTIALS_ID}",
                    branch: "${env.BRANCH_NAME}"
            }
        }
        stage('Get Latest Version') {
            steps {
                script {
                    def latestVersion = sh(script: "git tag --list v0.0.1-beta-* | sed 's/^v//' | sort -rV | head -n 1", returnStdout: true).trim()

                    // If there is no previous version, set the latest version to 0.0.1-beta-1.
                    if (latestVersion == '') {
                        latestVersion = '0.0.1-beta-1'
                    }

                    // Extract the numeric part of the latest version and increment it by 1.
                    def newVersion = latestVersion.replaceAll(/(.*-beta-)(\d+)$/) { _, prefix, num ->
                        "${prefix}${(num.toInteger() + 1)}"
                    }


                    // Print the new version.
                    println "New Version: ${newVersion}"
                }
            }
        }

    }
}
